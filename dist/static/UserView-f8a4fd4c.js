import{_ as F}from"./index-1dd2e770.js";/* empty css                  *//* empty css                   *//* empty css               *//* empty css                 */import{T as $}from"./TablesView-0e0987a0.js";import{H as N,_ as E,r as w,l as U,m as k,V as e,P as t,T as d,aB as I,ay as L,A as M,$ as O,w as j,p as y,u as B}from"./vue-95bbca75.js";import{U as R}from"./index-9a8b9b3e.js";/* empty css                     *//* empty css                 */import{a as q,y as A,x as G,s as H,q as W,o as P,z as J,b as K,r as Q,p as X}from"./element-9ce10ab4.js";/* empty css                  *//* empty css                    */const Y=[{prop:"username",label:"用户名",sortable:!0,showOverflowTooltip:!0,Color:"black"},{prop:"phone",label:"手机号",showOverflowTooltip:!0,Color:"black"},{prop:"permissions",label:"权限",sortable:!0,slot:"permissions",Color:"black"},{width:"140",label:"操作",buttons:[{name:"删除",type:"danger",icon:"Delete",command:"delete"}],Color:"black"}],Z=N({__name:"CreateUserWindows",props:{dialog:Boolean},emits:["add"],setup(T,{emit:n}){const f=T,l=E({username:"",password:"",password_again:"",email:"",phone:"",permissions:"0"}),i=w(),_=E({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],password_again:[{required:!0,message:"请输入确认密码",trigger:"change"},{validator:(m,o,u)=>{o!==l.password?u(new Error("两次输入的密码不一致")):u()},trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"}],permissions:[{required:!0,message:"请选择用户权限",trigger:"blur"}]});f.dialog;const s=w(!1);s.value=f.dialog;const v=m=>R.create_user(m),z=m=>{m&&m.validate((o,u)=>{if(o)v(l).then(p=>{p.data.code==200&&(q.success(p.data.data),s.value=!1,n("add",s.value))});else return!1})},V=()=>{s.value=!1,n("add",s.value)};return(m,o)=>{const u=A,p=G,x=H,S=W,C=P,r=J;return U(),k("div",null,[e(r,{ref_key:"ruleFormRef",ref:i,model:l,"label-width":"140px",rules:_},{default:t(()=>[e(p,{label:"用户名",prop:"username"},{default:t(()=>[e(u,{modelValue:l.username,"onUpdate:modelValue":o[0]||(o[0]=a=>l.username=a),type:"text",placeholder:"请输入用户名",autocomplete:"off",minlength:"8",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"密码",prop:"password"},{default:t(()=>[e(u,{modelValue:l.password,"onUpdate:modelValue":o[1]||(o[1]=a=>l.password=a),type:"password",placeholder:"请输入密码",autocomplete:"off",clearable:"",style:{width:"200px"},"show-password":""},null,8,["modelValue"])]),_:1}),e(p,{label:"确认密码",prop:"password_again"},{default:t(()=>[e(u,{modelValue:l.password_again,"onUpdate:modelValue":o[2]||(o[2]=a=>l.password_again=a),type:"password",placeholder:"请再次输入密码",clearable:"",style:{width:"200px"},"show-password":""},null,8,["modelValue"])]),_:1}),e(p,{label:"手机号",prop:"phone"},{default:t(()=>[e(u,{modelValue:l.phone,"onUpdate:modelValue":o[3]||(o[3]=a=>l.phone=a),type:"text",placeholder:"请输入手机号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"邮箱",prop:"email"},{default:t(()=>[e(u,{modelValue:l.email,"onUpdate:modelValue":o[4]||(o[4]=a=>l.email=a),type:"text",placeholder:"请输入邮箱",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(p,{label:"用户身份",prop:"permissions"},{default:t(()=>[e(S,{modelValue:l.permissions,"onUpdate:modelValue":o[5]||(o[5]=a=>l.permissions=a)},{default:t(()=>[e(x,{label:"1"},{default:t(()=>[d("管理员")]),_:1}),e(x,{label:"0"},{default:t(()=>[d("普通用户")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(C,{type:"primary",onClick:o[6]||(o[6]=a=>z(i.value))},{default:t(()=>[d("创建")]),_:1}),e(C,{onClick:V},{default:t(()=>[d("取消")]),_:1})]),_:1})]),_:1},8,["model","rules"])])}}}),ee={class:"users_search"},ae={key:0},le={key:1},oe=N({__name:"UserView",setup(T){const n=I(),f=L(),l=M("reload"),i=w(),_=w(!1);n.query.search&&(i.value=n.query.search);const s={page:Number(n.query.page)||1,pageSize:Number(n.query.pageSize)||10,search:String(n.query.search)||""},v=E({tableDemoList:[],options:{showPagination:!0}}),{options:z}=O(v),V=w([]),m=(r,a,c)=>{switch(r){case"edit":alert("点击了编辑");break;case"delete":K.confirm(`确认用户${a.username}删除吗？`,"提示").then(()=>{R.delete_user({username:a.username}).then(g=>{g.data.code==200?(q.success("删除成功"),l()):q.error("删除失败")})}).catch(()=>null);break}},o=async(r,a,c=s.search)=>{await f.push({path:n.path,query:{page:r,pageSize:a,search:c}}),l()},u=()=>{i.value,i.value?f.push({path:n.path,query:{page:1,pageSize:10,search:i.value}}):(q.error("请输入搜索内容"),l())},p=async()=>{i.value="",await f.replace({path:n.path,query:{page:1,pageSize:10,search:""}}),l()},x=()=>{_.value=!0},S=r=>{_.value=r,r||l()},C=(r=1,a=10,c="")=>R.getUserList({page:r,page_size:a,search:c});return j(()=>n.query,async r=>{const{page:a,pageSize:c,search:g}=r;s.page=Number(a)||s.page,s.pageSize=Number(c)||s.pageSize,s.search=g||"",C(s.page,s.pageSize,s.search).then(b=>{V.value=b.data.data.list,v.options.paginationConfig={total:b.data.data.total,currentPage:s.page,pageSize:s.pageSize,pageSizes:[10,20,50],layout:"total,prev, pager, next,sizes"}})},{immediate:!0}),(r,a)=>{const c=A,g=P,b=Q,D=X;return U(),k("div",null,[y("div",ee,[e(c,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=h=>i.value=h),placeholder:"请输入搜索内容",style:{width:"300px","margin-left":"10px"},clearable:""},null,8,["modelValue"]),e(g,{type:"primary",onClick:u,style:{"margin-left":"30px"}},{default:t(()=>[d("搜索")]),_:1}),e(g,{type:"primary",onClick:p},{default:t(()=>[d("重置")]),_:1}),e(g,{type:"primary",onClick:x},{default:t(()=>[d("创建用户")]),_:1})]),y("div",null,[e($,{columns:B(Y),"table-data":V.value,options:B(z),onPaginationChange:o,onCommand:m},{permissions:t(({row:h})=>[h.permissions==1?(U(),k("div",ae,[y("span",null,[e(b,{type:"danger"},{default:t(()=>[d("管理员")]),_:1})])])):(U(),k("div",le,[y("span",null,[e(b,{type:"success"},{default:t(()=>[d("普通用户")]),_:1})])]))]),_:1},8,["columns","table-data","options"])]),y("div",null,[e(D,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=h=>_.value=h),title:"创建用户"},{default:t(()=>[e(Z,{dialog:_.value,onAdd:S},null,8,["dialog"])]),_:1},8,["modelValue"])])])}}});const be=F(oe,[["__scopeId","data-v-fb7624e0"]]);export{be as default};
